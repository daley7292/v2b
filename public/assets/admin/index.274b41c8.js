import{y as g,B as v,C as k,v as T,_ as X}from"./index.931e29e8.js";/* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css               */import{d as z,r as Z,f as _,w as A,C as P,D as V,aI as e,aH as a,u as s,aM as f,aN as b,aK as $,aJ as q,aW as R,b2 as Q,b7 as Y,b8 as ee,b9 as te,bB as ae,bC as ne,aX as G,b3 as H,b5 as oe,c as le,aZ as de,bz as se,a6 as me,aV as ie,bR as re,bE as ue,b6 as pe}from"./arco.d070d3bc.js";import{u as ce}from"./loading.50473042.js";import{c as L}from"./cloneDeep.47777689.js";/* empty css               *//* empty css               */import{b as _e}from"./comm-config.3cd00c2d.js";import"./chart.dd5d83bb.js";import"./vue.02dbc53f.js";const fe={id:0,uuid:"",payment:"",name:"",icon:"",config:{app_id:"",private_key:"",public_key:"",product_name:""},notify_domain:"",handling_fee_fixed:0,handling_fee_percent:"",enable:0,sort:"",created_at:0,updated_at:0,notify_url:""},ye=()=>g.get(v.queryPayMethods),he=u=>g.post(v.showPayMethod,k(u)),be=()=>g.get(v.getPaymentMethods),ge=u=>g.post(v.getPaymentForm,k(u)),ve=u=>g.post(v.savePaymentMethod,k(u)),xe=u=>g.post(v.SortPaymentMethod,k(u)),Me=u=>g.post(v.DropPaymentMethod,k(u)),Pe=z({__name:"payment",props:["data"],emits:["closeModal"],setup(u,{emit:p}){const x=u,{t:l}=T.exports.useI18n(),F=()=>{p("closeModal")},n=Z(x.data),S=_([]),j=()=>{be().then(i=>{S.value=i.data})},B=i=>{let t={...n};t.handling_fee_fixed&&(t.handling_fee_fixed=t.handling_fee_fixed*100),ve(t).then(m=>{m.data&&(R.success({content:l("payment.form.save_success")}),F())})},C=_([]),w=()=>{!n.payment||ge({id:n.id,payment:n.payment}).then(i=>{C.value=[],Object.keys(i.data).forEach(t=>{C.value.push({field:t,label:i.data[t].label,description:i.data[t].description,type:i.data[t].type})})})};return w(),A(()=>x.data,i=>{Object.keys(i).forEach(t=>{t==="config"?Object.keys(n[t]).forEach(m=>{n[t][m]=i[t][m]}):n[t]=i[t]}),n.handling_fee_fixed=n.handling_fee_fixed/100,w()}),j(),(i,t)=>{const m=Q,c=Y,U=ee,M=te,d=ae,r=ne,y=G,D=H,E=oe;return P(),V("div",null,[e(E,{layout:"vertical",ref:"paymentMethod",model:n,onSubmit:B},{default:a(()=>[e(c,{field:"name",label:s(l)("payment.form.display_name")},{default:a(()=>[e(m,{modelValue:n.name,"onUpdate:modelValue":t[0]||(t[0]=o=>n.name=o),placeholder:s(l)("payment.form.display_name_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:s(l)("payment.form.icon_url")},{default:a(()=>[e(m,{modelValue:n.icon,"onUpdate:modelValue":t[1]||(t[1]=o=>n.icon=o),placeholder:s(l)("payment.form.icon_url_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"notify_domain",label:s(l)("payment.form.custom_notify_domain")},{default:a(()=>[e(m,{modelValue:n.notify_domain,"onUpdate:modelValue":t[2]||(t[2]=o=>n.notify_domain=o),placeholder:s(l)("payment.form.custom_notify_domain_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(M,null,{default:a(()=>[e(U,{span:11},{default:a(()=>[e(c,{field:"handling_fee_percent",label:s(l)("payment.form.percentage_fee")},{default:a(()=>[e(m,{modelValue:n.handling_fee_percent,"onUpdate:modelValue":t[3]||(t[3]=o=>n.handling_fee_percent=o),type:"number",min:0,placeholder:s(l)("payment.form.percentage_fee_desc")},{append:a(()=>[f("%")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(U,{span:11,offset:2},{default:a(()=>[e(c,{field:"handling_fee_fixed",label:s(l)("payment.form.handling_fee_percent")},{default:a(()=>[e(m,{modelValue:n.handling_fee_fixed,"onUpdate:modelValue":t[4]||(t[4]=o=>n.handling_fee_fixed=o),type:"number",min:0,placeholder:s(l)("payment.form.handling_fee_percent_desc")},{append:a(()=>[f(b(s(_e)()),1)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),e(c,{field:"payment",label:s(l)("payment.form.interface_file")},{default:a(()=>[e(r,{modelValue:n.payment,"onUpdate:modelValue":t[5]||(t[5]=o=>n.payment=o),placeholder:s(l)("payment.form.interface_file_desc"),onChange:w},{default:a(()=>[(P(!0),V($,null,q(S.value,(o,I)=>(P(),V("div",{key:I},[e(d,{value:o},{default:a(()=>[f(b(o),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),(P(!0),V($,null,q(C.value,(o,I)=>(P(),V("div",{key:I},[e(c,{field:o.field,label:o.label},{default:a(()=>[e(m,{placeholder:o.description,modelValue:n.config[o.field],"onUpdate:modelValue":N=>n.config[o.field]=N},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["field","label"])]))),128)),e(c,{style:{"align-items":"center"}},{default:a(()=>[e(D,null,{default:a(()=>[e(y,{onClick:F,type:"dashed"},{default:a(()=>[f(b(s(l)("button.cancel")),1)]),_:1}),e(y,{"html-type":"submit",type:"primary"},{default:a(()=>[f(b(s(l)("button.ok")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])}}}),Ve={class:"container"},Ce={name:"SettingPayment"},we=z({...Ce,setup(u){const{t:p}=T.exports.useI18n(),x=_(),l=_(!1),F=()=>{let d={...fe};x.value=d,l.value=!0},n=()=>{l.value=!1,M()},S=async d=>{try{await he({id:d.id})}finally{M()}},j=d=>{t.value=d;let r=[];d.forEach((y,D)=>{r.push(y.id)}),xe({ids:r})},B=d=>{let r={...d};r.handling_fee_fixed=r.handling_fee_fixed/100,x.value=r,l.value=!0},C=async d=>{Me({id:d.id}).then(r=>{r.data&&(M(),R.success({content:p("message.delete.success")}))})},{loading:w,setLoading:i}=ce(!0),t=_([]),m=_([]),c=_([]);_("medium");const U=le(()=>[{title:p("payment.columns.index"),dataIndex:"id",slotName:"index"},{title:p("payment.columns.enable"),dataIndex:"enable",slotName:"enable"},{title:p("payment.columns.name"),dataIndex:"name"},{title:p("payment.columns.payment"),dataIndex:"payment"},{title:p("payment.columns.notify_url"),dataIndex:"notify_url",slotName:"notify_url"},{title:p("payment.columns.operations"),dataIndex:"operations",slotName:"operations"}]),M=async()=>{i(!0);const d=await ye();t.value=d.data,i(!1)};return M(),A(()=>U.value,d=>{m.value=L(d),m.value.forEach((r,y)=>{r.checked=!0}),c.value=L(m.value)},{deep:!0,immediate:!0}),(d,r)=>{const y=de("Breadcrumb"),D=se,E=me,o=G,I=ie,N=re,J=H,K=ue,W=pe;return P(),V("div",Ve,[e(y,{items:["menu.system","menu.system.payment"]},null,8,["items"]),e(D,{visible:l.value,"onUpdate:visible":r[0]||(r[0]=h=>l.value=h),footer:!1,"unmount-on-close":!0,width:"650px"},{default:a(()=>[e(Pe,{data:x.value,onCloseModal:n},null,8,["data"])]),_:1},8,["visible"]),e(W,null,{default:a(()=>[e(o,{type:"primary",onClick:F,style:{"margin-bottom":"10px"}},{icon:a(()=>[e(E)]),default:a(()=>[f(" "+b(d.$t("payment.operation.add")),1)]),_:1}),e(K,{"row-key":"id",loading:s(w),columns:m.value,data:t.value,bordered:!1,pagination:!1,onChange:j,draggable:{type:"handle",width:40}},{enable:a(({record:h})=>[e(I,{"default-checked":h.enable==1,"checked-text":"\u542F\u7528","unchecked-text":"\u7981\u7528",onChange:O=>S(h)},null,8,["default-checked","onChange"])]),operations:a(({record:h})=>[e(J,null,{default:a(()=>[e(N,{content:s(p)("permission.delete"),onOk:O=>C(h),type:"warning"},{default:a(()=>[e(o,{type:"primary",status:"danger"},{default:a(()=>[f(b(s(p)("button.delete")),1)]),_:1})]),_:2},1032,["content","onOk"]),e(o,{onClick:O=>B(h),type:"primary",size:"small"},{default:a(()=>[f(b(d.$t("button.edit")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["loading","columns","data"])]),_:1})])}}});const He=X(we,[["__scopeId","data-v-83230d2a"]]);export{He as default};
