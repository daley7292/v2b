import{v as $,j as se,k as ue,_ as pe}from"./index.931e29e8.js";/* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css                *//* empty css              *//* empty css               *//* empty css               */import{d as Q,f as w,r as K,o as de,aZ as L,C as x,D as I,aI as e,aH as t,u as n,aM as s,G as A,aN as u,aK as J,aJ as H,aW as R,b2 as ce,b7 as _e,bD as me,b8 as fe,b9 as be,aX as W,bB as he,bC as ye,bN as we,b3 as ve,b5 as Ve,c as ge,w as xe,aE as Ce,aF as Ie,a6 as ke,bO as Ne,aV as Se,I as Te,ag as Ue,be as qe,af as De,b4 as Pe,bE as Ee,b6 as Fe,aY as Be}from"./arco.d070d3bc.js";import{u as Ge}from"./loading.50473042.js";import{c as M}from"./cloneDeep.47777689.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               */import{Q as X}from"./node.75130ad4.js";import{S as ze,d as O,P as je,D as Me,a as Oe,Q as $e}from"./subscription.ae1f303c.js";import"./chart.dd5d83bb.js";import"./vue.02dbc53f.js";const Qe=Q({__name:"subscription-form",props:["data"],emits:["close"],setup(F,{emit:d}){const v=F,{t:i}=$.exports.useI18n(),k=w([]),D=async()=>{const{data:f}=await X();k.value=f},P=["month_price","quarter_price","half_year_price","year_price","two_year_price","three_year_price","onetime_price","reset_price"],N=()=>d("close"),l=K(v.data),B=()=>{let f={};Object.keys(l).forEach(o=>{P.includes(o)?f[o]=l[o]*100:f[o]=l[o]}),f.speed_limit||(f.speed_limit=0),f.reset_traffic_method==="undefined"&&(f.reset_traffic_method=" "),ze(f).then(o=>{o.data&&(R.success("\u63D0\u4EA4\u6210\u529F"),N())})};return D(),de(()=>{l.reset_traffic_method==null&&(l.reset_traffic_method="undefined")}),(f,o)=>{const _=ce,c=_e,C=me,h=fe,S=be,y=W,T=L("router-link"),b=he,U=ye,E=we,V=ve,p=Ve;return x(),I("div",null,[e(p,{layout:"vertical",ref:"subscription",model:l,onSubmit:B},{default:t(()=>[e(c,{field:"name",label:n(i)("subscription.form.name")},{default:t(()=>[e(_,{modelValue:l.name,"onUpdate:modelValue":o[0]||(o[0]=a=>l.name=a),placeholder:n(i)("subscription.placeholder.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:n(i)("subscription.form.description")},{default:t(()=>[e(C,{modelValue:l.content,"onUpdate:modelValue":o[1]||(o[1]=a=>l.content=a),placeholder:n(i)("subscription.placeholder.description")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(S,null,{default:t(()=>[e(h,{span:3},{default:t(()=>[e(c,{label:n(i)("subscription.form.monthly")},{default:t(()=>[e(_,{modelValue:l.month_price,"onUpdate:modelValue":o[2]||(o[2]=a=>l.month_price=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(h,{span:3,offset:1},{default:t(()=>[e(c,{label:n(i)("subscription.form.quarterly")},{default:t(()=>[e(_,{modelValue:l.quarter_price,"onUpdate:modelValue":o[3]||(o[3]=a=>l.quarter_price=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(h,{span:3,offset:1},{default:t(()=>[e(c,{label:n(i)("subscription.form.half_year")},{default:t(()=>[e(_,{modelValue:l.half_year_price,"onUpdate:modelValue":o[4]||(o[4]=a=>l.half_year_price=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(h,{span:3,offset:1},{default:t(()=>[e(c,{label:n(i)("subscription.form.yearly")},{default:t(()=>[e(_,{modelValue:l.year_price,"onUpdate:modelValue":o[5]||(o[5]=a=>l.year_price=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(h,{span:3,offset:1},{default:t(()=>[e(c,{label:n(i)("subscription.form.two_year")},{default:t(()=>[e(_,{modelValue:l.two_year_price,"onUpdate:modelValue":o[6]||(o[6]=a=>l.two_year_price=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(h,{span:3,offset:1},{default:t(()=>[e(c,{label:n(i)("subscription.form.three_year")},{default:t(()=>[e(_,{modelValue:l.three_year_price,"onUpdate:modelValue":o[7]||(o[7]=a=>l.three_year_price=a)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(S,null,{default:t(()=>[e(h,{span:11},{default:t(()=>[e(c,{label:n(i)("subscription.form.onetime")},{default:t(()=>[e(_,{modelValue:l.onetime_price,"onUpdate:modelValue":o[8]||(o[8]=a=>l.onetime_price=a)},{append:t(()=>[s(" \uFFE5 ")]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1}),e(h,{span:12,offset:1},{default:t(()=>[e(c,{label:n(i)("subscription.form.reset_package")},{default:t(()=>[e(_,{modelValue:l.reset_price,"onUpdate:modelValue":o[9]||(o[9]=a=>l.reset_price=a)},{append:t(()=>[s(" \uFFE5 ")]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),e(c,{label:n(i)("subscription.form.traffic")},{default:t(()=>[e(_,{modelValue:l.transfer_enable,"onUpdate:modelValue":o[10]||(o[10]=a=>l.transfer_enable=a)},{append:t(()=>[s(" GB ")]),_:1},8,["modelValue"])]),_:1},8,["label"]),e(c,null,{label:t(()=>[A("span",null,u(n(i)("subscription.form.permission_group")),1),e(T,{to:"/"+n(se)+"/server/permission_group"},{default:t(()=>[e(y,{type:"text"},{default:t(()=>[s(u(n(i)("subscription.form.add_permission_group")),1)]),_:1})]),_:1},8,["to"])]),default:t(()=>[e(U,{style:{width:"100%"},modelValue:l.group_id,"onUpdate:modelValue":o[11]||(o[11]=a=>l.group_id=a),placeholder:n(i)("subscription.placeholder.select_permission")},{default:t(()=>[(x(!0),I(J,null,H(k.value,(a,m)=>(x(),I("div",{key:m},[e(b,{value:a.id},{default:t(()=>[s(u(a.name),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),e(c,{field:"post",label:n(i)("subscription.form.reset_method")},{default:t(()=>[e(U,{modelValue:l.reset_traffic_method,"onUpdate:modelValue":o[12]||(o[12]=a=>l.reset_traffic_method=a),placeholder:n(i)("subscription.placeholder.select_reset_method")},{default:t(()=>[e(b,{value:"undefined"},{default:t(()=>[s(u(n(i)("subscription.reset_method.system")),1)]),_:1}),e(b,{value:0},{default:t(()=>[s(u(n(i)("subscription.reset_method.monthly_first")),1)]),_:1}),e(b,{value:3},{default:t(()=>[s(u(n(i)("subscription.reset_method.yearly_first")),1)]),_:1}),e(b,{value:1},{default:t(()=>[s(u(n(i)("subscription.reset_method.monthly")),1)]),_:1}),e(b,{value:5},{default:t(()=>[s(u(n(i)("subscription.reset_method.quarterly")),1)]),_:1}),e(b,{value:6},{default:t(()=>[s(u(n(i)("subscription.reset_method.half_year")),1)]),_:1}),e(b,{value:4},{default:t(()=>[s(u(n(i)("subscription.reset_method.yearly")),1)]),_:1}),e(b,{value:2},{default:t(()=>[s(u(n(i)("subscription.reset_method.no_reset")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:n(i)("subscription.form.max_capacity")},{default:t(()=>[e(_,{modelValue:l.capacity_limit,"onUpdate:modelValue":o[13]||(o[13]=a=>l.capacity_limit=a),placeholder:n(i)("subscription.placeholder.no_limit")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:n(i)("subscription.form.speed_limit")},{default:t(()=>[e(_,{modelValue:l.speed_limit,"onUpdate:modelValue":o[14]||(o[14]=a=>l.speed_limit=a),placeholder:n(i)("subscription.placeholder.no_speed_limit")},{append:t(()=>[s(" Mbps ")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:n(i)("subscription.form.ip_limit")},{default:t(()=>[e(_,{modelValue:l.ip_limit,"onUpdate:modelValue":o[15]||(o[15]=a=>l.ip_limit=a),type:"number",placeholder:n(i)("subscription.placeholder.ip_limit")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:n(i)("subscription.form.device_count")},{default:t(()=>[e(_,{modelValue:l.block_plant_cont,"onUpdate:modelValue":o[16]||(o[16]=a=>l.block_plant_cont=a),type:"number",placeholder:n(i)("subscription.placeholder.max_devices")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(c,{field:"name",label:n(i)("subscription.form.force_update")},{default:t(()=>[e(E,{modelValue:l.force_update,"onUpdate:modelValue":o[17]||(o[17]=a=>l.force_update=a)},null,8,["modelValue"])]),_:1},8,["label"]),e(c,null,{default:t(()=>[e(V,null,{default:t(()=>[e(y,{type:"dashed",onClick:N},{default:t(()=>[s(u(n(i)("button.cancel")),1)]),_:1}),e(y,{type:"primary","html-type":"submit"},{default:t(()=>[s(u(n(i)("subscription.button.submit")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])}}}),Ke={class:"container"},Le={style:{"margin-bottom":"15px"}},Ae={name:"ServerNode"},Je=Q({...Ae,setup(F){const{t:d}=$.exports.useI18n(),v=w(!1),i=w(O),k=p=>{je(p).then(()=>{V()})},D=["month_price","quarter_price","half_year_price","year_price","two_year_price","three_year_price","onetime_price","reset_price"],P=p=>{let a={...p};a.force_update=!0,Object.keys(p).forEach(m=>{D.includes(m)?a[m]&&(a[m]=p[m]/100):a[m]=p[m]}),i.value=a,v.value=!0},N=p=>{Me(p.id).then(a=>{a.data&&(R.success(d("subscription.delete.success")),V())})},l=w([]);(async()=>{const{data:p}=await X();l.value=p})();const f=()=>{v.value=!1,V(y)},{loading:o,setLoading:_}=Ge(!0),c=w([]),C=w([]),h=w([]),S=w("medium"),y={current:1,pageSize:100},T=K({...y,showTotal:!0,showJumper:!0,showPageSize:!0,pageSizeOptions:[100,500,1e3]}),b=p=>{c.value=p;let a=[];p.forEach((m,G)=>{a.push(m.id)}),Oe({plan_ids:a})},U=p=>{T.pageSize=p,y.pageSize=p,V({...y,pageSize:p})},E=ge(()=>[{title:d("subscriptionTable.columns.id"),dataIndex:"id",slotName:"id",width:80},{title:d("subscriptionTable.columns.show"),dataIndex:"show",slotName:"show",width:100},{title:d("subscriptionTable.columns.renew"),dataIndex:"renew",slotName:"renew",width:80},{title:d("subscriptionTable.columns.name"),dataIndex:"name",slotName:"name",width:120},{title:d("subscriptionTable.columns.count"),dataIndex:"count",slotName:"count",width:80},{title:d("subscriptionTable.columns.transfer_enable"),dataIndex:"transfer_enable",slotName:"transfer_enable",width:80},{title:d("subscriptionTable.columns.month_price"),dataIndex:"month_price",slotName:"month_price",width:80},{title:d("subscriptionTable.columns.quarter_price"),dataIndex:"quarter_price",slotName:"quarter_price",width:80},{title:d("subscriptionTable.columns.half_year_price"),dataIndex:"half_year_price",slotName:"half_year_price",width:80},{title:d("subscriptionTable.columns.year_price"),dataIndex:"year_price",slotName:"year_price",width:80},{title:d("subscriptionTable.columns.two_year_price"),dataIndex:"two_year_price",slotName:"two_year_price",width:80},{title:d("subscriptionTable.columns.three_year_price"),dataIndex:"three_year_price",slotName:"three_year_price",width:80},{title:d("subscriptionTable.columns.onetime_price"),dataIndex:"onetime_price",slotName:"onetime_price",width:80},{title:d("subscriptionTable.columns.reset_price"),dataIndex:"reset_price",slotName:"reset_price",width:80},{title:d("subscriptionTable.columns.group_id"),dataIndex:"group_id",slotName:"group_id",width:120},{title:d("subscriptionTable.columns.operations"),dataIndex:"operations",slotName:"operations",fixed:"right"}]),V=async p=>{p||(p={...y}),_(!0);try{const{data:a}=await $e(p);c.value=a}catch{}finally{_(!1)}};return V(y),xe(()=>E.value,p=>{C.value=M(p),C.value.forEach((a,m)=>{a.checked=!0}),h.value=M(C.value)},{deep:!0,immediate:!0}),(p,a)=>{const m=L("Breadcrumb"),G=ke,q=W,Y=Ne,Z=ue,z=Se,ee=Te,te=Ue,j=qe,ae=De,oe=Pe,le=Ee,ne=Fe,ie=Be;return x(),I("div",Ke,[e(m,{items:["menu.finance","menu.finance.subscription"]},null,8,["items"]),e(ne,null,{default:t(()=>[A("div",Le,[e(q,{type:"outline",onClick:a[0]||(a[0]=()=>{v.value=!0,i.value=n(O)})},{icon:t(()=>[e(G)]),default:t(()=>[s(" "+u(n(d)("subscription.button.create")),1)]),_:1})]),e(le,{"row-key":"id",loading:n(o),pagination:T,columns:C.value,data:c.value,bordered:!1,size:S.value,onPageChange:p.onPageChange,onPageSizeChange:U,onChange:b,draggable:{type:"handle",width:40}},{group_id:t(({record:r})=>[(x(!0),I(J,null,H(l.value,(g,re)=>(x(),I("div",{key:re},[r.group_id==g.id?(x(),Ce(Y,{key:0,value:g.id,color:"arcoblue","default-checked":!0},{default:t(()=>[s(u(g.name),1)]),_:2},1032,["value"])):Ie("",!0)]))),128))]),count:t(({record:r})=>[e(Z),s(" "+u(r.count),1)]),transfer_enable:t(({record:r})=>[s(u(r.transfer_enable)+" GB ",1)]),month_price:t(({record:r})=>[s(u(r.month_price?r.month_price/100:"-"),1)]),quarter_price:t(({record:r})=>[s(u(r.quarter_price?r.quarter_price/100:"-"),1)]),year_price:t(({record:r})=>[s(u(r.year_price?r.year_price/100:"-"),1)]),half_year_price:t(({record:r})=>[s(u(r.half_year_price?r.half_year_price/100:"-"),1)]),two_year_price:t(({record:r})=>[s(u(r.two_year_price?r.two_year_price/100:"-"),1)]),three_year_price:t(({record:r})=>[s(u(r.three_year_price?r.three_year_price/100:"-"),1)]),onetime_price:t(({record:r})=>[s(u(r.onetime_price?r.onetime_price/100:"-"),1)]),reset_price:t(({record:r})=>[s(u(r.reset_price?r.reset_price/100:"-"),1)]),show:t(({record:r})=>[e(z,{"checked-value":1,"unchecked-value":0,"default-checked":r.show,onChange:g=>k({id:r.id,show:r.show===0?1:0})},null,8,["default-checked","onChange"])]),renew:t(({record:r})=>[e(z,{"checked-value":1,"unchecked-value":0,"default-checked":r.renew,onChange:g=>k({id:r.id,renew:r.renew===0?1:0})},null,8,["default-checked","onChange"])]),operations:t(({record:r})=>[e(oe,{"popup-max-height":!1},{content:t(()=>[e(j,null,{default:t(()=>[e(q,{type:"text",onClick:g=>P(r),status:"success"},{default:t(()=>[e(te),s(" "+u(n(d)("button.edit")),1)]),_:2},1032,["onClick"])]),_:2},1024),e(j,null,{default:t(()=>[e(q,{onClick:g=>N(r),type:"text",status:"danger"},{default:t(()=>[e(ae),s(" "+u(n(d)("button.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[e(q,{type:"text"},{default:t(()=>[s(u(n(d)("subscriptionTable.columns.operations"))+" ",1),e(ee)]),_:1})]),_:2},1024)]),_:1},8,["loading","pagination","columns","data","size","onPageChange"])]),_:1}),e(ie,{width:650,visible:v.value,footer:!1,"unmount-on-close":!0,onCancel:a[1]||(a[1]=()=>{v.value=!1})},{title:t(()=>[s(u(n(d)("subscription.button.create")),1)]),default:t(()=>[e(Qe,{data:i.value,onClose:f},null,8,["data"])]),_:1},8,["visible"])])}}});const mt=pe(Je,[["__scopeId","data-v-59513e18"]]);export{mt as default};
