import{y as S,B as T,C as U,v as P,_ as ee}from"./index.931e29e8.js";/* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css                */import{d as j,r as ae,f as y,o as te,C as x,D as k,aI as e,aH as t,u as l,aK as q,aJ as $,aM as g,aN as h,aW as L,b2 as oe,b7 as re,bB as le,bC as ne,aX as Q,b3 as z,b5 as se,c as ue,w as de,aZ as me,G as ce,aE as ie,a6 as pe,bO as _e,bR as ve,bE as fe,b6 as be,bz as ye}from"./arco.d070d3bc.js";import{u as ge}from"./loading.50473042.js";import{c as O}from"./cloneDeep.47777689.js";/* empty css               *//* empty css               */import{Q as A}from"./node.75130ad4.js";import"./chart.dd5d83bb.js";import"./vue.02dbc53f.js";const V={id:0,name:"",domain:"",ua:"",sort:0,server_arr:"",temp_server_arr:[]},he=()=>S.get(T.queryRule),xe=p=>S.post(T.saveRule,U(p)),Ce=p=>S.post(T.saveRuleSort,U(p)),Ve=p=>S.post(T.deleteRule,U(p)),ke=j({__name:"rule-form",props:["data"],emits:["close"],setup(p,{emit:v}){const f=p,{t:s}=P.exports.useI18n(),R=()=>{v("close")},r=ae(f.data),I=y([]),D=async()=>{const{data:n}=await A();I.value=n},w=()=>{r.server_arr=r.temp_server_arr.toString(),r.sort||(r.sort=0),xe(r).then(n=>{n.data&&(R(),L.success("\u6DFB\u52A0\u6210\u529F"))})};return te(()=>{D()}),(n,u)=>{const c=oe,_=re,G=le,C=ne,N=Q,B=z,M=se;return x(),k("div",null,[e(M,{layout:"vertical"},{default:t(()=>[e(_,{field:"name",label:l(s)("menu.server.name")},{default:t(()=>[e(c,{modelValue:r.name,"onUpdate:modelValue":u[0]||(u[0]=d=>r.name=d),placeholder:l(s)("menu.server.name_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(_,{field:"domain",label:l(s)("menu.server.domain")},{default:t(()=>[e(c,{modelValue:r.domain,"onUpdate:modelValue":u[1]||(u[1]=d=>r.domain=d),placeholder:l(s)("menu.server.domain_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(_,{field:"ua",label:l(s)("menu.server.ua")},{default:t(()=>[e(c,{modelValue:r.ua,"onUpdate:modelValue":u[2]||(u[2]=d=>r.ua=d),placeholder:l(s)("menu.server.ua_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(_,{field:"port",label:l(s)("menu.server.port")},{default:t(()=>[e(c,{modelValue:r.port,"onUpdate:modelValue":u[3]||(u[3]=d=>r.port=d),type:"number",placeholder:l(s)("menu.server.port_desc")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(_,{field:"server_arr",label:l(s)("menu.server.service_group")},{default:t(()=>[e(C,{modelValue:r.temp_server_arr,"onUpdate:modelValue":u[4]||(u[4]=d=>r.temp_server_arr=d),placeholder:l(s)("menu.server.service_group_desc"),multiple:""},{default:t(()=>[(x(!0),k(q,null,$(I.value,(d,a)=>(x(),k("div",{key:a},[e(G,{value:d.id+""},{default:t(()=>[g(h(d.name),1)]),_:2},1032,["value"])]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(_,null,{default:t(()=>[e(B,null,{default:t(()=>[e(N,{type:"dashed",onClick:R},{default:t(()=>[g(h(l(s)("server.rule.cancel")),1)]),_:1}),e(N,{type:"primary",onClick:w},{default:t(()=>[g(h(l(s)("server.rule.submit")),1)]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Re={class:"container"},Ie={style:{"margin-bottom":"15px"}},we={name:"ServerRule"},Ne=j({...we,setup(p){const v=y(!1),f=y(V),s=()=>{f.value=V,v.value=!1,C()},R=a=>{const o=V;Object.keys(a).forEach(i=>{o[i]=a[i]});let m=[];o.server_arr&&o.server_arr.split(",").forEach((i,E)=>{m.push(i)}),o.temp_server_arr=m,f.value=o,v.value=!0},r=a=>{Ve({id:a.id}).then(o=>{o.data&&(f.value=V,L.success({content:n("message.delete.success")}),C())})},I=()=>{v.value=!0;let a=V;Object.keys(a).forEach(o=>{a[o]=void 0}),f.value=a},{loading:D,setLoading:w}=ge(!0),{t:n}=P.exports.useI18n(),u=y([]),c=y([]),_=y([]),G=ue(()=>[{title:n("ruleTable.columns.id"),dataIndex:"id",slotName:"id"},{title:n("ruleTable.columns.name"),dataIndex:"name"},{title:n("ruleTable.columns.domain"),dataIndex:"domain",slotName:"domain"},{title:n("ruleTable.columns.ua"),dataIndex:"ua",slotName:"ua"},{title:n("ruleTable.columns.server_arr"),dataIndex:"server_arr",slotName:"server_arr"},{title:n("ruleTable.columns.operations"),dataIndex:"operations",slotName:"operations"}]),C=async()=>{w(!0);try{const{data:a}=await he();u.value=a}catch{}finally{w(!1)}},N=a=>{u.value=a;let o=[];a.forEach((m,i)=>{o.push(m.id)}),Ce({ids:o})},B=y([]);(async()=>{const{data:a}=await A();B.value=a})();const d=a=>{const o=[];return B.value.forEach(m=>{a.server_arr.split(",").forEach(i=>{i===m.id+""&&o.push(m.name)})}),o};return C(),de(()=>G.value,a=>{c.value=O(a),c.value.forEach((o,m)=>{o.checked=!0}),_.value=O(c.value)},{deep:!0,immediate:!0}),(a,o)=>{const m=me("Breadcrumb"),i=pe,E=Q,H=_e,J=ve,K=z,W=fe,X=be,Z=ye;return x(),k("div",Re,[e(m,{items:["menu.server","menu.server.rule"]},null,8,["items"]),e(X,null,{default:t(()=>[ce("div",Ie,[e(E,{onClick:o[0]||(o[0]=b=>I()),type:"outline"},{icon:t(()=>[e(i)]),default:t(()=>[g(" "+h(l(n)("server.rule.create")),1)]),_:1})]),e(W,{"row-key":"id",loading:l(D),columns:c.value,data:u.value,bordered:!1,pagination:!1,onChange:N,draggable:{type:"handle",width:40}},{server_arr:t(({record:b})=>[(x(!0),k(q,null,$(d(b),(F,Y)=>(x(),ie(H,{key:Y,bordered:""},{default:t(()=>[g(h(F),1)]),_:2},1024))),128))]),operations:t(({record:b})=>[e(K,null,{default:t(()=>[e(E,{type:"primary",onClick:F=>R(b)},{default:t(()=>[g(h(l(n)("server.rule.edit")),1)]),_:2},1032,["onClick"]),e(J,{content:l(n)("permission.delete"),onOk:F=>r(b),type:"warning"},{default:t(()=>[e(E,{type:"primary",status:"danger"},{default:t(()=>[g(h(l(n)("server.rule.del")),1)]),_:1})]),_:2},1032,["content","onOk"])]),_:2},1024)]),_:1},8,["loading","columns","data"])]),_:1}),e(Z,{visible:v.value,"onUpdate:visible":o[1]||(o[1]=b=>v.value=b),"unmount-on-close":!0,footer:!1},{default:t(()=>[e(ke,{data:f.value,onClose:s},null,8,["data"])]),_:1},8,["visible"])])}}});const Je=ee(Ne,[["__scopeId","data-v-e5d36391"]]);export{Je as default};
